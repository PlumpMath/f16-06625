#+BEGIN_SRC python :results output org drawer
from __future__ import division
import numpy as np
import matplotlib.pyplot as plt
import pycse.orgmode as org
from scipy.optimize import fsolve


R = 8.314e-3  # kJ/mol/K
T = 573.15 # in K
species = ['NH3', 'N2', 'H2']
Hf298 = [-45.90,  # NH3
            0.0,  # N2
            0.0]  # H2

Ca0 = 0.1 # M
Cb0 = 0
Cc0 = 0
xispan = np.linspace(-0.5, 0.5, 1000)
Kc = 1/9.6
# plotting f vs a range of xi_eq and seeing where it goes to 0
nu = np.array([-2, 1, 3])
C0 = np.array([Ca0, Cb0, Cc0]) # initial concentrations
f = np.zeros(len(xispan))
for i in range(len(xispan)):
    C = C0 + nu * xispan[i]
    f[i] = Kc - np.prod(C**nu)


xispanr = np.linspace(0, 0.1)
f1 = np.zeros(len(xispanr))
for i in range(len(xispanr)):
    C1 = C0 + nu * xispanr[i]
    f1[i] = Kc - np.prod(C1**nu)

plt.figure(figsize=(6, 4))
plt.plot(xispan, f)
plt.plot([-0.5, 0.5], [0, 0], 'k--')
plt.xlabel('extent')
plt.ylabel('objective function')
plt.ylim(-1, 0.5)
plt.xlim(-0.5, 0.5)
plt.tight_layout()
org.figure(plt.savefig('function vs extent.png'),caption = 'function vs extent')


def extent(xi_eq):
    nu = np.array([-2, 1, 3])
    C0 = np.array([Ca0, Cb0, Cc0]) # initial concentrations
    C = C0 + nu * xi_eq
    f = Kc - np.prod(C**nu)
    return f

xi_eqf, = fsolve(extent, 0.03)
print('Equilibrium extent = {0:1.4f}'.format(xi_eqf))

print('C_NH3 = {0:1.4f} mol / L'.format(Ca0 + nu[0]*xi_eqf))
print('C_N2 = {0:1.4f} mol / L'.format(Cb0 + nu[1]*xi_eqf))
print('C_H2 = {0:1.4f} mol / L'.format(Cc0 + nu[2]*xi_eqf))

#+END_SRC

#+RESULTS:
:RESULTS:
#+CAPTION: function vs extent
[[file:function vs extent.png]]
Equilibrium extent = 0.0382
C_NH3 = 0.0235 mol / L
C_N2 = 0.0382 mol / L
C_H2 = 0.1147 mol / L
:END:

#+BEGIN_SRC python :results output org drawer
import numpy as np

# Thursday homework
Kp_old = 0.00459926651124

n = 2 - 4
Kc = 1 / 9.6 
T = 300 + 273 # K
R = 8.314e-3  # kJ/mol/K

Kp = Kc * (R * T)**n

C0 = [0.1, 0., 0.]

def func(xi):
    return Kp - (xi**2) / (Ca0 - xi)**2

from scipy.optimize import fsolve
guess = 0.05
xi_eq, = fsolve(func, guess)
print('xi_eq = ', xi_eq)

print('C_A = {0:1.4f} mol / L'.format(Ca0 - xi_eq))
print('C_C = {0:1.4f} mol / L'.format(xi_eq))

xispan = np.linspace(-0.5, 0.5, 1000)

#+END_SRC

#+RESULTS:
:RESULTS:
-9.40604828701e-06
:END:


\(\ce{2NH3} \leftrightharpoons \ce{N2} + \ce{3H2}\) at 300 Â°C is approximately:

#+BEGIN_SRC python :results output org drawer
import numpy as np
import matplotlib.pyplot as plt

# Thursday homework
Kp_old = 0.00459926651124

n = 2 - 4
Kc = 1 / 9.6 
T = 300 + 273 # K
R = 8.314e-3  # kJ/mol/K

Kp = Kc * (R * T)**n

C0 = [0.1, 0., 0.]
a = [2, 1, 3]

def func(xi):
    CA = (C0[0] + a[0]*xi)**a[0]
    CB = (C0[1] + a[1]*xi)**a[1]
    CC = (C0[2] + a[2]*xi)**a[2]

    return Kp - (CB * CC) / CA

from scipy.optimize import fsolve
guess = 0.5
xi_eq, = fsolve(func, guess)
print('xi_eq = ',xi_eq)

xispan = np.linspace(0, 0.5)
ans = [func(x) for x in xispan]

fig, ax = plt.subplots(figsize=(6, 4))
ax.plot(xispan, ans)
ax.plot([-0.5, 0.5], [0, 0], 'k--')
ax.set_xlabel('extent')
ax.set_ylabel('objective function')
ax.set_xlim(xispan[0], xispan[-1])
# ax.get_xaxis().set_ticks([])

plt.tight_layout()
plt.savefig('example_xi.png')

print('C_A = {0:1.4f} mol / L'.format(C0[0] - xi_eq))
print('C_C = {0:1.4f} mol / L'.format(xi_eq))
#+END_SRC

#+RESULTS:
:RESULTS:
('xi_eq = ', 0.051428511315431094)
C_A = 0.0486 mol / L
C_C = 0.0514 mol / L
:END:

[[./example_xi.png]]